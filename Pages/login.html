<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng nh·∫≠p - B·ªánh Vi·ªán ƒêa Khoa</title>
    
    <link rel="stylesheet" href="../icon/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="logo-icon">
                    <i class="ti-pulse"></i>
                </div>
                <h2>B·ªánh Vi·ªán ƒêa Khoa</h2>
                <p>H·ªá th·ªëng qu·∫£n l√Ω b·ªánh vi·ªán</p>
            </div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">
                        <i class="ti-user"></i> T√™n ƒëƒÉng nh·∫≠p
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username"
                        required 
                        placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
                        autocomplete="username"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i class="ti-lock"></i> M·∫≠t kh·∫©u
                    </label>
                    <div class="password-input-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            name="password"
                            required 
                            placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                            autocomplete="current-password"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword()">
                            <i class="ti-eye" id="toggleIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="role">
                        <i class="ti-id-badge"></i> Vai tr√≤ / Quy·ªÅn truy c·∫≠p
                    </label>
                    <div class="select-wrapper">
                        <select id="role" name="role" required>
                            <option value="">-- Ch·ªçn vai tr√≤ --</option>
                            <option value="admin">
                                üë®‚Äçüíº Qu·∫£n tr·ªã vi√™n (Admin)
                            </option>
                            <option value="doctor">
                                üë®‚Äç‚öïÔ∏è B√°c sƒ©
                            </option>
                            <option value="nurse">
                                üë©‚Äç‚öïÔ∏è Y t√°
                            </option>
                            <option value="caregiver">
                                üè• ƒêi·ªÅu d∆∞·ª°ng
                            </option>
                            <option value="accountant">
                                üí∞ K·∫ø to√°n
                            </option>
                            <option value="patient">
                                üë§ B·ªánh nh√¢n
                            </option>
                        </select>
                        <i class="ti-angle-down select-arrow"></i>
                    </div>
                    <small class="form-hint">Vui l√≤ng ch·ªçn vai tr√≤ c·ªßa b·∫°n trong h·ªá th·ªëng</small>
                </div>
                
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe">
                        <span>Ghi nh·ªõ ƒëƒÉng nh·∫≠p</span>
                    </label>
                    <a href="#" class="forgot-password">Qu√™n m·∫≠t kh·∫©u?</a>
                </div>
                
                <button type="submit" class="btn-login" id="loginBtn">
                    <i class="ti-unlock" id="loginIcon"></i>
                    <span id="loginBtnText">ƒêƒÉng nh·∫≠p</span>
                </button>
            </form>
            
            <div class="demo-accounts">
                <div class="demo-header">
                    <i class="ti-info"></i>
                    <h4>T√†i kho·∫£n demo (click ƒë·ªÉ ch·ªçn):</h4>
                </div>
                <div class="demo-list">
                    <div onclick="fillLogin('admin', 'admin', 'admin')" class="demo-account-item">
                        <i class="ti-crown"></i>
                        <div>
                            <strong>Qu·∫£n tr·ªã vi√™n</strong>
                            <span>admin / admin</span>
                        </div>
                    </div>
                    <div onclick="fillLogin('doctor', 'doctor', 'doctor')" class="demo-account-item">
                        <i class="ti-user"></i>
                        <div>
                            <strong>B√°c sƒ©</strong>
                            <span>doctor / doctor</span>
                        </div>
                    </div>
                    <div onclick="fillLogin('nurse', 'nurse', 'nurse')" class="demo-account-item">
                        <i class="ti-heart"></i>
                        <div>
                            <strong>Y t√°</strong>
                            <span>nurse / nurse</span>
                        </div>
                    </div>
                    <div onclick="fillLogin('caregiver', 'caregiver', 'caregiver')" class="demo-account-item">
                        <i class="ti-home"></i>
                        <div>
                            <strong>ƒêi·ªÅu d∆∞·ª°ng</strong>
                            <span>caregiver / caregiver</span>
                        </div>
                    </div>
                    <div onclick="fillLogin('accountant', 'accountant', 'accountant')" class="demo-account-item">
                        <i class="ti-money"></i>
                        <div>
                            <strong>K·∫ø to√°n</strong>
                            <span>accountant / accountant</span>
                        </div>
                    </div>
                    <div onclick="fillLogin('patient', 'patient', 'patient')" class="demo-account-item">
                        <i class="ti-wheelchair"></i>
                        <div>
                            <strong>B·ªánh nh√¢n</strong>
                            <span>patient / patient</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="login-footer">
                <p>Ch∆∞a c√≥ t√†i kho·∫£n? <a href="./register.html">ƒêƒÉng k√Ω ngay</a></p>
            </div>
        </div>
    </div>
    
    <script src="../js/auth.js"></script>
    <script>
        // Ki·ªÉm tra n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p th√¨ t·ª± ƒë·ªông redirect
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = sessionStorage.getItem('currentUser');
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    // ƒê√£ ƒëƒÉng nh·∫≠p, chuy·ªÉn ƒë·∫øn trang admin
                    window.location.href = 'admin.html';
                } catch (e) {
                    // N·∫øu kh√¥ng parse ƒë∆∞·ª£c th√¨ x√≥a v√† cho ƒëƒÉng nh·∫≠p l·∫°i
                    sessionStorage.removeItem('currentUser');
                }
            }
        });
        
        function fillLogin(username, password, role) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
            document.getElementById('role').value = role;
            
            // Highlight selected role
            const select = document.getElementById('role');
            select.style.borderColor = '#0056b3';
            setTimeout(() => {
                select.style.borderColor = '';
            }, 1000);
        }
        
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('ti-eye');
                toggleIcon.classList.add('ti-eye-close');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('ti-eye-close');
                toggleIcon.classList.add('ti-eye');
            }
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginIcon = document.getElementById('loginIcon');
            
            // Ki·ªÉm tra input
            if (!username || !password || !role) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ƒëƒÉng nh·∫≠p!');
                return;
            }
            
            // Disable button v√† hi·ªÉn th·ªã loading
            loginBtn.disabled = true;
            loginBtnText.textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
            loginIcon.classList.remove('ti-unlock');
            loginIcon.classList.add('ti-reload');
            loginIcon.style.animation = 'spin 1s linear infinite';
            
            // G·ªçi h√†m login t·ª´ auth.js
            if (typeof login === 'function') {
                const loginResult = login(username, password, role);
                
                if (loginResult) {
                    // L∆∞u remember me n·∫øu ƒë∆∞·ª£c ch·ªçn
                    if (rememberMe) {
                        localStorage.setItem('rememberUser', JSON.stringify({
                            username: username,
                            role: role
                        }));
                    }
                    
                    // ƒê·∫£m b·∫£o sessionStorage ƒë√£ ƒë∆∞·ª£c set tr∆∞·ªõc khi redirect
                    setTimeout(function() {
                        window.location.href = 'admin.html';
                    }, 300);
                } else {
                    // Kh√¥i ph·ª•c button n·∫øu ƒëƒÉng nh·∫≠p th·∫•t b·∫°i
                    resetLoginButton();
                    alert('ƒêƒÉng nh·∫≠p th·∫•t b·∫°i! Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin.');
                }
            } else {
                resetLoginButton();
                alert('L·ªói h·ªá th·ªëng! Vui l√≤ng th·ª≠ l·∫°i sau.');
            }
        }
        
        function resetLoginButton() {
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginIcon = document.getElementById('loginIcon');
            
            loginBtn.disabled = false;
            loginBtnText.textContent = 'ƒêƒÉng nh·∫≠p';
            loginIcon.classList.remove('ti-reload');
            loginIcon.classList.add('ti-unlock');
            loginIcon.style.animation = '';
        }
        
        // Load remembered user
        document.addEventListener('DOMContentLoaded', function() {
            const remembered = localStorage.getItem('rememberUser');
            if (remembered) {
                try {
                    const user = JSON.parse(remembered);
                    document.getElementById('username').value = user.username || '';
                    document.getElementById('role').value = user.role || '';
                    document.getElementById('rememberMe').checked = true;
                } catch (e) {
                    // Ignore
                }
            }
        });
    </script>
    
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
